<!-- 响应式布局设计 -->
<view class="page" style="width: 100%; max-width: 393px; min-height: 100vh; margin: 0 auto; background: #F8F9FD; overflow: hidden">
  
  <!-- 头部: 响应式高度 -->
  <view style="width: 100%; height: 57px; background: white; border-bottom: 1px #F3F4F6 solid; display: flex; align-items: center; padding: 0 14px">
    <view style="width: 140px; height: 35px; display: flex; align-items: center">
        <!-- 头像: 35px × 35px -->
          <view style="width: 35px; height: 35px; overflow: hidden; border-radius: 16777200px; display: flex; align-items: center; justify-content: center; margin-right: 10.5px;" bindtap="showProfile">
            <t-icon name="user-avatar" size="35px" />
          </view>
          <!-- 新建按钮: 94.50px × 31.50px -->
          <view style="width: 94.50px; height: 31.50px; background: linear-gradient(135deg, #FF6B6B 0%, #EE5A6F 100%); box-shadow: 0px 2px 4px -2px rgba(0, 0, 0, 0.10),0px 4px 6px -1px rgba(0, 0, 0, 0.10); border-radius: 16777200px; display: flex; align-items: center; padding-left: 10.5px" bindtap="onNewWork">
            <t-icon name="add" size="14px" style="margin-right: 10px" />
            <text style="color: white; font-size: 12.25px; font-family: Inter; font-weight: 500">新建作品</text>
          </view>
      </view>
    </view>

  <!-- 主内容: 响应式高度 -->
  <view style="width: 100%; background: #F9FAFB; padding-top: 14px">
    
    <!-- 标题行: 响应式宽度 -->
    <view style="display: flex; justify-content: space-between; align-items: center; padding: 0 14px 14px 14px">
      <view style="display: flex; align-items: center">
          <text style="color: #1A1D2E; font-size: 15.75px; font-family: Inter; font-weight: 500; margin-right: 5px">我的作品</text>
          <text style="color: #6A7282; font-size: 12.25px; font-family: Inter; font-weight: 400">({{works.length}})</text>
        </view>
        <!-- 搜索按钮: 61.25px × 28px -->
        <view style="width: 61.25px; height: 28px; background: #F3F4F6; border-radius: 8.50px; display: flex; align-items: center; padding-left: 8.75px" bindtap="onSearch">
          <t-icon name="search" size="14px" style="margin-right: 8px" />
          <text style="color: #1A1D2E; font-size: 10.50px; font-family: Inter; font-weight: 500; letter-spacing: 0.09px">搜索</text>
        </view>
    </view>

    <!-- 作品卡片网格: 响应式宽度 -->
    <view style="width: calc(100% - 28px); margin: 0 14px; display: flex; flex-wrap: wrap; justify-content: space-between;">
      <!-- 动态作品卡片 -->
        <view wx:for="{{works}}" wx:key="_id" wx:for-index="index" 
              style="width: calc(50% - 8px); margin-bottom: 32px; background: white; box-shadow: 0px 1px 2px -1px rgba(0, 0, 0, 0.10),0px 1px 3px rgba(0, 0, 0, 0.10); overflow: hidden; border-radius: 14px; display: flex; flex-direction: column;">
          <!-- 图片区: 响应式高度 - 可点击进入详情 -->
          <block wx:if="{{item.coverPreview || item.cover}}">
            <image src="{{item.coverPreview || item.cover}}" style="width: 100%; aspect-ratio: 0.75;" bindtap="goToDetail" data-id="{{item._id}}" data-name="{{item.name}}" />
          </block>
          <block wx:else>
            <view style="width: 100%; aspect-ratio: 0.75; display: flex; align-items: center; justify-content: center; background: #F3F4F6;" bindtap="goToDetail" data-id="{{item._id}}" data-name="{{item.name}}">
              <t-icon name="image" size="36px" />
            </view>
          </block>
          <!-- 卡片内容区 -->
          <view style="padding: 10.5px; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between;">
          <view style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
              <text style="color: #1a1d2e; font-size: 12.25px; font-family: Inter; font-weight: 500; max-width: calc(100% - 35px); line-height: 1.3; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">{{item.name || '未命名作品'}}</text>
              <view style="width: 25px; height: 25px; border-radius: 12.5px; background: rgba(0, 0, 0, 0.05); display: flex; align-items: center; justify-content: center;" bindtap="showEditModal" data-id="{{item._id}}" data-name="{{item.name}}">
                <t-icon name="more" size="16px" />
              </view>
            </view>
            <view style="display: flex; align-items: center; flex-wrap: wrap;">
              <view
                wx:for="{{item.tags}}"
                wx:for-item="tag"
                wx:key="index"
                wx:for-index="tagIndex"
                wx:if="{{tagIndex < 2}}"
                style="min-width: 44px; height: 18.5px; padding: 0 8px; border-radius: 999px; display: flex; align-items: center; justify-content: center; box-shadow: 0px 1px 2px -1px rgba(0, 0, 0, 0.1), 0px 1px 3px rgba(0, 0, 0, 0.1); margin-right: 8px; max-width: 80px; overflow: hidden; background: {{tag.background}}"
              >
                <text style="font-size: 10px; font-family: Inter; font-weight: 500; color: {{tag.color}}">{{tag.name}}</text>
              </view>
              <view wx:if="{{item.tags.length > 2}}" style="min-width: 44px; height: 18.5px; padding: 0 8px; border-radius: 999px; display: flex; align-items: center; justify-content: center; box-shadow: 0px 1px 2px -1px rgba(0, 0, 0, 0.1), 0px 1px 3px rgba(0, 0, 0, 0.1); max-width: 80px; overflow: hidden;">
                <text style="font-size: 10px; font-family: Inter; font-weight: 500">+{{item.tags.length - 2}}</text>
              </view>
            </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 底部编辑弹层 -->
  <view wx:if="{{showEditModal}}" class="edit-modal">
    <view class="edit-modal__mask" bindtap="hideEditModal"></view>
    <view class="edit-modal__panel" catchtouchmove="true">
      <view class="edit-modal__handle"></view>
      <view class="edit-modal__title">{{currentWorkName}}</view>
      <view class="edit-modal__subtitle">项目编辑</view>
      <view class="edit-modal__list">
        <view class="edit-modal__item" bindtap="editWork">
          <t-icon name="edit-1" size="16px" class="edit-modal__icon" />
          <text class="edit-modal__text">编辑作品</text>
        </view>
        <view class="edit-modal__item" bindtap="renameWork">
          <t-icon name="text" size="16px" class="edit-modal__icon" />
          <text class="edit-modal__text">重命名</text>
        </view>
        <view class="edit-modal__item" bindtap="setCover">
          <t-icon name="image" size="16px" class="edit-modal__icon" />
          <text class="edit-modal__text">设置封面</text>
        </view>
        <view class="edit-modal__item" bindtap="openTagSheet">
          <t-icon name="tag" size="16px" class="edit-modal__icon" />
          <text class="edit-modal__text">作品标签</text>
        </view>
        <view class="edit-modal__item" bindtap="cardDecoration">
          <t-icon name="brush" size="16px" class="edit-modal__icon" />
          <text class="edit-modal__text">卡片装饰</text>
        </view>
      </view>
      <view class="edit-modal__list">
        <view class="edit-modal__item" bindtap="shareWork">
          <t-icon name="share-1" size="16px" class="edit-modal__icon" />
          <text class="edit-modal__text">分享作品</text>
        </view>
        <view class="edit-modal__item" bindtap="copyWork">
          <t-icon name="copy" size="16px" class="edit-modal__icon" />
          <text class="edit-modal__text">复制作品</text>
        </view>
      </view>
      <view class="edit-modal__divider"></view>
      <view class="edit-modal__item edit-modal__item--danger" bindtap="deleteWork">
        <t-icon name="delete" size="16px" class="edit-modal__icon" />
        <text class="edit-modal__text edit-modal__text--danger">删除作品</text>
      </view>
      <view class="edit-modal__cancel" bindtap="hideEditModal">
        <text>取消</text>
      </view>
    </view>
  </view>

  <!-- 标签选择弹层 -->
  <view wx:if="{{tagSheetVisible}}" class="tag-sheet" catchtouchmove="true">
    <view class="tag-sheet__mask" bindtap="closeTagSheet"></view>
    <view class="tag-sheet__panel" catchtap="noop">
      <view class="tag-sheet__handle"></view>
      <view class="tag-sheet__header">
        <text class="tag-sheet__title">作品标签</text>
        <text class="tag-sheet__subtitle">为 "{{tagSheetTargetName}}" 选择标签，最多 {{maxTagCount}} 个</text>
      </view>
      <view wx:if="{{tagSheetLoading}}" class="tag-sheet__loading">标签加载中...</view>
      <view wx:else>
        <scroll-view scroll-y="true" class="tag-sheet__scroll">
          <view class="tag-sheet__grid">
            <view
              wx:for="{{tagList}}"
              wx:key="_id"
              class="tag-sheet__option {{tagSelection.indexOf(item._id) >= 0 ? 'selected' : ''}}"
              data-id="{{item._id}}"
              bindtap="toggleTagSelection"
            >
              <view class="tag-sheet__pill" style="background: {{item.background}}">
                <text style="color: {{item.color}};">{{item.name}}</text>
              </view>
              <view wx:if="{{tagSelection.indexOf(item._id) >= 0}}" class="tag-sheet__check">
                <view class="tag-sheet__checkmark"></view>
              </view>
            </view>
          </view>
        </scroll-view>
        <view wx:if="{{!tagList.length}}" class="tag-sheet__empty">暂无可用标签，请先在标签管理中创建。</view>
      </view>
      <button
        class="tag-sheet__confirm"
        bindtap="applyTagSheet"
        loading="{{tagSheetSaving}}"
        disabled="{{tagSheetSaving || tagSheetLoading}}"
      >
        保存
      </button>
    </view>
  </view>

  <!-- 自定义字段底部弹出模态框 -->
  <view wx:if="{{showCustomFieldsModal}}" style="width: 393px; height: 852px; left: 0px; top: 0px; position: fixed; z-index: 2000">
    <!-- 遮罩层: 不覆盖底部模态框区域 -->
    <view style="width: 393px; height: 302px; left: 0px; top: 0px; position: absolute; background: rgba(0, 0, 0, 0.50); z-index: 1" bindtap="hideCustomFieldsModal"></view>
    
    <!-- 底部弹出内容: 393px × 550px -->
    <view style="width: 393px; height: 550px; left: 0px; top: 302px; position: absolute; background: #F8F9FD; border-top-left-radius: 10.50px; border-top-right-radius: 10.50px; border-top: 1px #E5E7EB solid; z-index: 2">
      <!-- 拖拽条 -->
      <view style="width: 100px; height: 7px; left: 146.50px; top: 15px; position: absolute; background: #F1F3F9; border-radius: 16777200px"></view>
      
      <!-- 标题: 393px × 21px -->
      <view style="width: 365px; height: 21px; left: 14px; top: 36px; position: absolute">
        <text style="left: 0px; top: 0px; position: absolute; color: #1A1D2E; font-size: 14px; font-family: Inter; font-weight: 600">自定义字段</text>
      </view>
      
      <!-- 字段列表区域: 393px × 398.50px -->
      <view style="width: 393px; height: 398.50px; left: 0px; top: 71px; position: absolute; overflow: hidden" catchtouchmove="true">
        <!-- 说明文字: 365px × 17.50px -->
        <view style="width: 365px; height: 17.50px; left: 14px; top: 0px; position: absolute">
          <text style="left: 0px; top: 0.50px; position: absolute; color: #6A7282; font-size: 12.25px; font-family: Inter; font-weight: 400">自定义作品简介中显示的字段，可以添加、编辑、删除和排序。</text>
        </view>
        
        <!-- 字段列表: 365px × 360px -->
        <view style="width: 365px; height: 360px; left: 14px; top: 31.50px; position: absolute; overflow-y: auto" catchtouchmove="true">
          <view wx:for="{{customFields}}" wx:key="id" wx:for-index="index" style="width: 365px; height: 51px; left: 0px; top: {{index * 58}}px; position: absolute; background: white; border-radius: 14.50px; outline: 1px #E5E7EB solid; outline-offset: -1px">
            <view style="width: 342px; height: 28px; left: 11.50px; top: 11.50px; position: absolute">
              <!-- 拖拽图标 -->
              <view style="width: 14px; height: 14px; left: 0px; top: 7px; position: absolute; {{index === 0 ? 'opacity: 0.30' : ''}}">
                <t-icon name="drag-move" size="14px" />
              </view>
              
              <!-- 字段标签 -->
              <view style="width: 49px; height: 21px; left: 24.50px; top: 3.50px; position: absolute; background: {{item.colorObj.background}}; border-radius: 16777200px">
                <t-icon name="{{item.icon}}" size="10.5px" style="left: 7px; top: 5.25px; position: absolute" />
                <text style="left: 21px; top: 3.50px; position: absolute; color: {{item.colorObj.text}}; font-size: 10.50px; font-family: Inter; font-weight: 400; letter-spacing: 0.09px">{{item.name}}</text>
              </view>
              
              <!-- 操作按钮 -->
              <view style="width: 258px; height: 28px; left: 84px; top: 0px; position: absolute">
                <!-- 上移按钮 -->
                <view wx:if="{{index > 0}}" style="width: 28px; height: 28px; left: 0px; top: 0px; position: absolute; border-radius: 8.50px" bindtap="moveFieldUp" data-id="{{item.id}}">
                  <t-icon name="arrow-up-3" size="14px" style="left: 7px; top: 7px; position: absolute;" />
                </view>
                
                <!-- 下移按钮 -->
                <view wx:if="{{index < customFields.length - 1}}" style="width: 28px; height: 28px; left: 31.50px; top: 0px; position: absolute; border-radius: 8.50px" bindtap="moveFieldDown" data-id="{{item.id}}">
                  <t-icon name="arrow-down-3" size="14px" style="left: 7px; top: 7px; position: absolute;" />
                </view>
                
                <!-- 编辑按钮 - 移到最右侧 -->
                <view style="width: 28px; height: 28px; left: 198.50px; top: 0px; position: absolute; border-radius: 8.50px" bindtap="editField" data-id="{{item.id}}">
                  <t-icon name="edit-1" size="14px" style="left: 7px; top: 7px; position: absolute;" />
                </view>
                
                <!-- 删除按钮 - 移到最右侧 -->
                <view style="width: 28px; height: 28px; left: 230px; top: 0px; position: absolute; border-radius: 8.50px" bindtap="deleteField" data-id="{{item.id}}" data-name="{{item.name}}">
                  <t-icon name="delete-1" size="14px" style="left: 7px; top: 7px; position: absolute;" />
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <!-- 添加新字段按钮: 365px × 42px - 放在最高层级 -->
      <view style="width: 365px; height: 42px; left: 14px; top: 405px; position: absolute; background: linear-gradient(135deg, #FF6B6B 0%, #EE5A6F 100%); box-shadow: 0px 2px 4px -2px rgba(0, 0, 0, 0.10),0px 4px 6px -1px rgba(0, 0, 0, 0.10); border-radius: 16777200px; z-index: 9999" bindtap="goToAddField">
        <t-icon name="add" size="14px" style="left: 137.88px; top: 14px; position: absolute;" />
        <text style="left: 165.88px; top: 12.75px; position: absolute; color: white; font-size: 12.25px; font-family: Inter; font-weight: 500">添加新字段</text>
      </view>
    </view>
  </view>

  <!-- 引入个人资料侧边栏 -->
  <include src="./profile.wxml" />

</view>